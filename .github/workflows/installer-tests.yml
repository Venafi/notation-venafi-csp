name: Plugin installer tests
# Run on every push, and allow it to be run manually.
on:
  workflow_dispatch:
  push:
    branches: ['main', 'v*']
  pull_request:

env:
  NOTATION_VERSION: 1.0.1

jobs:
  windows-installer-test:
    name: Run tests
    runs-on: windows-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v3
      - name: download notation
        shell: pwsh
        run: |
          echo "Downloading notation version"
          curl -sL https://github.com/notaryproject/notation/releases/download/v${{ env.NOTATION_VERSION }}/notation_${{ env.NOTATION_VERSION }}_windows_amd64.zip -o notation.zip
          Expand-Archive -Path notation.zip
      - name: run windows installer
        shell: pwsh
        run: |
          # Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://github.com/venafi/notation-venafi-csp/install/install.ps1')) 
          cd install
          ./install.ps1
      - name: test plugin
        shell: pwsh
        run: |
          cd notation
          ./notation plugin ls
  